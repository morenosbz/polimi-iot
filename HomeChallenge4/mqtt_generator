[{"id":"dc904c8e.7d9648","type":"function","z":"b5d1af96.0416f8","name":"extract_value","func":"\ntraffLine = msg.payload;\n\nplcDepFilter = [\n        \"department1/section1/plc\",\n        \"department3/section3/plc\"\n    ]\nhvDepFilter = [\n        \"department1/section1/hydraulic_valve\",\n        \"department3/section3/hydraulic_valve\"\n    ]\n\nif (traffLine.includes(\"MQTT\") &&  traffLine.includes(\"Publish\")){\n    plc = getValue(plcDepFilter)\n    hv = getValue(hvDepFilter)\n    if(plc || hv){\n        return {sensor:{p: plc, h: hv}};\n    } else {\n        //NOOP\n    }\n} else {\n    // NOOP\n}\n\nfunction getValue(depFilter){\n    if ( \n        traffLine.includes(depFilter[0]) || \n        traffLine.includes(depFilter[1])\n        ){\n            var content = traffLine.split(\" \");\n            var hex = content[content.length - 1].split(',')[0]\n            var str = '';\n    \t    for (var n = 0; n < hex.length; n += 2) {\n        \t\tstr += String.fromCharCode(parseInt(hex.substr(n, 2), 16));\n    \t    }\n    \t    var sensor = JSON.parse(str);\n            return sensor.value;\n            \n        } else {\n            //NOOP\n        }\n}\n\n\n","outputs":1,"noerr":0,"x":260,"y":280,"wires":[["ba9bad1b.b3993","943664b7.1dd328"]]}]
