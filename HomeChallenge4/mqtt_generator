[{"id":"dc904c8e.7d9648","type":"function","z":"b5d1af96.0416f8","name":"extract_value","func":"lines = msg.payload.split(/\\r?\\n/);\nmqtt_lines = lines.filter(function(line){return line.includes(\"MQTT\")});\n\nplcDepFilter = [\n        \"department1/section1/plc\",\n        \"department3/section3/plc\"\n    ]\nhvDepFilter = [\n        \"department1/section1/hydraulic_valve\",\n        \"department3/section3/hydraulic_valve\"\n    ]\n\nplc = getValue(plcDepFilter)\nhv = getValue(hvDepFilter)\n\nfunction getValue(depFilter){\n    return mqtt_lines.filter(function(line){\n        return line.includes(\"Publish\");\n    }).filter(function(line){\n        return  line.includes(depFilter[0]) || \n        line.includes(depFilter[1]);\n    }).map(function(line){\n        var content = line.split(\" \");\n        return content[content.length - 1].split(',')[0];\n    }).map(function(hex){\n        hex = hex.toString();\n        var str = '';\n    \tfor (var n = 0; n < hex.length; n += 2) {\n    \t\tstr += String.fromCharCode(parseInt(hex.substr(n, 2), 16));\n    \t}\n        return JSON.parse(str);\n    }).map(function(sensor){\n        return sensor.value;\n    })\n}\n\nreturn [plc, hv];\n","outputs":2,"noerr":0,"x":440,"y":220,"wires":[["da0d611e.1e38f8"],[]]}]
